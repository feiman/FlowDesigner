<!DOCTYPE HTML>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>流程模型管理</title>
<link rel="stylesheet" type="text/css" href="css/designer.css" />
<script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="dragController.js"></script>
<script type="text/javascript" src="designer.js"></script>
<script type="text/javascript">

$(function(){
	$('#cancleMoveBtn').hide();
	
	$('#actInfo').hide();
	//用来测试的模型
	var testModel = {activities:
		  [
			{model:{
				activityId:'0000',
				activityName:'任务分配',
				activityType:'01',
				displayName:'任务分配'
			  },
			  view:{
				displayindex:168,
				height:36,
				width:28,
				x:349,
				y:28
			  }
			},
		  ],
		  operations:[
		    {model:{
		    	activityId:'0000',
		    	autoFinish:'0',
		    	displayName:'分配完成',
		    	operationId:'000001',
		    	sequence:0 //sequence 就是优先级.
		      },
		      view:{
		    	x:257,
		    	y:90
		      }
			  
		    }
		  ]
	};
	
	//初始化绘图器
	var flRenderer = FlRenderer('designer',
			{'onSelect':function(obj){
					alert(obj);
				}
			}
	);
	
	//加载这个模型
	flRenderer.loadModel(testModel);
	
	//移动坐标系的控制器
	var movimgDragCtrl = getMovimgDragCtrl(flRenderer);
	//移动按钮的点击事件
	$('#moveBtn').click(function(){
		flRenderer.setDragCtrl(movimgDragCtrl);
		$('#moveBtn').hide();
		$('#cancleMoveBtn').show();
		$('#designer').css({"cursor":'move'});
	});
	//取消移动按钮的点击事件
	$('#cancleMoveBtn').click(function(){
		flRenderer.resetDragCtrl();
		$('#cancleMoveBtn').hide();
		$('#moveBtn').show();
		$('#designer').css({"cursor":'default'});
	});
	
	
	$('#makeCenterBtn').click(function(){
		flRenderer.makeCenter();
	});
	
	
	//左边的按钮
	//任意一人（环节）
	$('#tool1Btn').click(function(){
		//获取画布的中心点坐标
		var center = flRenderer.getCenter();
		//新创建一个业务对象
		var act = {model:{
			activityId:'',
			activityName:'活动名称',
			activityType:'01',
			displayName:'活动名称'
		  },
		  view:{
			displayindex:168,
			height:36,
			width:28,
			x:(center.x-26/2),
			y:(center.y-36/2)
		  }
		};
		flRenderer.addAct(act);
	});
	
	$('#tool2Btn').click(function(){
		//获取画布的中心点坐标
		var center = flRenderer.getCenter();
		//新创建一个业务对象
		var operation = {model:{
			activityId:'',
			activityName:'',
			description:'',
			displayName:'操作名称',
			operationName:'操作名称',
			operationId:''
		  },
		  view:{
			displayindex:169,
			height:16,
			width:16,
			x:(center.x-16/2),
			y:(center.y-16/2)
		  }
		};
		
		flRenderer.addOper(operation);
	});
	$('#toolNodeBtn').click(function(){
		//获取画布的中心点坐标
		var center = flRenderer.getCenter();
		//新创建一个业务对象
		var subseq = {model:{
			activityId:'',
			operationId:''
		  },
		  view:{
			x:(center.x-16/2),
			y:(center.y-16/2)
		  }
		};
		
		flRenderer.addSubseq(subseq);
	});
});
</script>
</head>
<body>
  <div class="topButtons" >
  	<button ><img src="imgs/design/menus/disk.png">保存</button>
  	<button ><img src="imgs/design/menus/folder-open-image-disk.png">打开</button>
  	<button ><img src="imgs/design/menus/document-attribute-x-export.png">下载</button>
  	<button id="moveBtn" ><img src="">移动</button>
  	<button id="cancleMoveBtn" ><img src="">取消移动</button>
  	<button id="makeCenterBtn" ><img src="">居中</button>
  </div>
  <div class="main" >
    <div class="asideTools">
      <div class="title">图形库</div>
      <div id="tool1Btn" >
        <img id="tool1" src="imgs/design/anyone.gif">
        <div>任意一人</div>
      </div>
      <div id="tool2Btn" >
        <img id="tool2" src="imgs/design/Blue Ball.png">
        <div>结果线</div>
      </div>
      <div id="toolNodeBtn" >
        <img id="toolNode" src="imgs/design/node.png">
        <div>后续线</div>
      </div>
    </div>
    <canvas id="designer" width="865px" height="560px" ></canvas>
    <div class="rightInfo">
      
      <!-- 活动信息 -->
      <div id="actInfo">
	      <div class="title">活动基本信息</div>
	      <table class="info">
	      	<tbody>
	      	  <tr>
	      	    <td class="dt" >活动代码</td>
	      	    <td class="dc" ><input name="activityId" type="text" ></td>
	      	  </tr>
	      	  <tr>
	      	    <td class="dt" >活动名称</td>
	      	    <td class="dc" ><input name="activityName" type="text" ></td>
	      	  </tr>
	      	  <tr>
	      	    <td class="dt" >显示名称</td>
	      	    <td class="dc" ><input name="displayName" type="text" ></td>
	      	  </tr>
	      	  <tr>
	      	    <td class="dt" >权限代码</td>
	      	    <td class="dc" ><input name="resourceId" type="text" ></td>
	      	  </tr>
	      	  <tr>
	      	    <td class="dt" >链接地址</td>
	      	    <td class="dc" ><input name="linkpath" type="text" ></td>
	      	  </tr>
	      	  <tr>
	      	    <td class="dt" >排序号</td>
	      	    <td class="dc" ><input name="listNo" type="text" ></td>
	      	  </tr>
	      	  <tr>
	      	    <td class="dt" >活动说明</td>
	      	    <td class="dc" ><input name="description" type="text" ></td>
	      	  </tr>
	      	  <tr>
	      	    <td class="dt" >活动类型</td>
	      	    <td class="dc" >
	      	      <select name="activityType" >
	      	        <option value="01" >任意一人</option>
	      	        <option value="02" >多人顺序</option>
	      	        <option value="03" >多人并行</option>
	      	      </select>
	      	    </td>
	      	  </tr>
	      	  <tr>
	      	    <td class="dt" >是否可撤回</td>
	      	    <td class="dc" >
	      	      <input name="canWithdraw" type="checkbox" >
	      	    </td>
	      	  </tr>
	      	</tbody>
	      </table>
	      <div class="title">活动控制信息</div>
	      <table class="info">
	      	<tbody>
	      	  <tr>
	      	    <td class="dt" >
	      	      <label><input name="activityBz" type="radio" value="0" >普通活动</label>
	      	    </td>
	      	    <td class="dd" >
	      	    </td>
	      	  </tr>
	      	  <tr>
	      	    <td class="dt" >
	      	      <label><input name="activityBz" type="radio" value="1" >开始活动</label>
	      	    </td>
	      	    <td class="dd" >
	      	              流程必须要有一个开始活动。
	      	    </td>
	      	  </tr>
	      	  <tr>
	      	    <td class="dt" >
	      	      <label><input name="activityBz" type="radio" value="2" >自动完成</label>
	      	    </td>
	      	    <td class="dd" >
	      	               同组触发顺序的其他活动均已完成时，本活动自动完成，并触发下一触发顺序的活动。
	      	    </td>
	      	  </tr>
	      	</tbody>
	      </table>
	    </div>
	    
	    <!-- 结果线信息 -->
	    <div id="operInfo">
	      <div class="title">结果基本信息</div>
	      <table class="info">
	      	<tbody>
	      	  <tr>
	      	    <td class="dt" >结果代码</td>
	      	    <td class="dc" ><input name="operationId" type="text" ></td>
	      	  </tr>
	      	  <tr>
	      	    <td class="dt" >结果名称</td>
	      	    <td class="dc" ><input name="operationName" type="text" ></td>
	      	  </tr>
	      	  <tr>
	      	    <td class="dt" >业务名称</td>
	      	    <td class="dc" ><input name="displayName" type="text" ></td>
	      	  </tr>
	      	  <tr>
	      	    <td class="dt" >排序号</td>
	      	    <td class="dc" ><input name="listNo" type="text" ></td>
	      	  </tr>
	      	  <tr>
	      	    <td class="dt" >结果说明</td>
	      	    <td class="dc" ><input name="description" type="text" ></td>
	      	  </tr>
	      	  <tr>
	      	    <td class="dt" >权限代码</td>
	      	    <td class="dc" ><input name="resourceId" type="text" ></td>
	      	  </tr>
	      	</tbody>
	      </table>
	      <div class="title">结果控制信息</div>
	      <div class="title">自动完成信息</div>
	    </div>
    </div>
    <div class="clear"></div>
  </div>
</body>
</html>